---
title: "Cougar Kill Analysis"
author: "Matthew Thompson"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# Load necessary libraries
if (!requireNamespace("tinytex", quietly = TRUE)) {
  install.packages("tinytex")  # Install tinytex if not already installed
}

if (!requireNamespace("knitr", quietly = TRUE)) {
  install.packages("knitr")    # Install knitr if not already installed
}

#packages setup
library(tinytex)
library(knitr)

getwd()
```

## Prompting Question

Look at the years and months this data was collected to determine completeness of this data. You should also check the data dictionary. If someone asked you if cougars ate during the winter, how would you answer them?

**Objectives**

1. Use a data dictionary to understand the data and explain what it's about briefly
2. Determine if the data frame is complete or not, especially in the years and months
3. Answer the question: Did cougars eat during the winter?

## Exporting Data and Installing Libraries

I need to export xlsx doc first before doing the data analysis. 

```{r export_cougarkillsites, echo=TRUE, message=FALSE}
#packages and libraries at the top
library(readxl)
library(dplyr)
library(reshape2)
library(lubridate) #for converting date format into day

cougarkillsites_completetable <- read_excel("Cougar Killsites.xlsx")
#Note: all of this data analysis are done within rproject for reproducibility
```

```{r assessing_killsites, echo = TRUE}

View(cougarkillsites_completetable) #opening up a tab to view the whole table
head(cougarkillsites_completetable) #opens up first 6 rows and a header
str(cougarkillsites_completetable) #list of all variables and type of data

```

## Data Dictionary

With the data successfully imported, what remains is a data dictionary for an understanding of this data, so the data dictionary is linked through here: https://onlinelibrary.wiley.com/doi/10.1002/ece3.7424

According to the data source, it seems the data's objective is to assess cougars' behavior and how they affect other carnivores like bears or are affected by other carnivore's presence while on the hunt for preys.

#### List of Variables for Quick Reference: \
\
NightsSpent: how many nights were spent on feeding their prey \
PredationMonth: when the predation happened in month (categorical) \
Cougar ID: each cougar tagged and ID'd \
DependentKittens: any current young kittens (count) \
Kittens. 3months: how old their cubs were (yes or no) \
Kittens. months: how old their cubs were (yes or no) \
CougarSex: categorical gender (male or female) \
DaysBetweenKillandInvestigation: the time between cougar's kill and how long it took for the bear to find its carcass and scavenges \
PreySpeciesSingle: what kind of prey a cougar ate \
PreyAgeClass: categorical age \
PreyWeightClass: categorical size \
HorsePresence: was the horse detected around the time of a predation \
Year: what year the predation occured \
BearDensity: likely refers to how many bears per area where a cougar is located \
DeerDensity: likely refers to how many deers per area where a cougar is located \
BearScav: bear scavenges the kill by cougars \
PredationDate: when the predation happened in full date

## Data Completeness

Now to determine the data completeness in years and months, I can find duplicates for each year and month and pinpoint if there are any missing data in any month or year.

```{r data_completeness, echo = TRUE}
#updated (Jan 24, 2025):
data_completeness_unique <- cougarkillsites_completetable %>% 
  unique()
#seems to be the best way to remove duplicates simply
#looks there are 8 duplicates (884 down to 876 observations)

data_completeness <- data_completeness_unique %>%
  group_by(Year, PredationMonth) %>%
  tally()

print(data_completeness)
#the main goal is to find gaps between years and months by looking for an unique items 
#with duplicate counts for each as an easy way to check 

data_completeness_verifycount <- data_completeness %>%
  filter(Year == "2009") %>%
  group_by(PredationMonth) %>%
  filter(PredationMonth %in% c("April", "August", "July"))

print(data_completeness_verifycount)
#Verified the count by counting the year and the first few months: April, August, and July
#which matches with the data_completeness 

#to further verify for NA just to double check again
data_completeness_NA <- data_completeness_unique %>%
  group_by(Year, PredationMonth) %>%
  filter(is.na(PredationMonth))

print(data_completeness_NA)
#result: 0 meaning no missing data for all months 
```
According to data_completeness, predation months typically occur between "March 1 to October 31" per year (Engebretsen et al. 2021). The years were recorded from 2009-2012 and 2015-2017. Strictly speaking by data completeness definition alone, I could argue the data is not complete since there were some gaps in both months and years. 

However, the research paper procedure seemed to suggest these targeted year and month range were intentional (March 1st - October 31st, 2009-2012 & 2015-2017). Additionally, there were no missing data in months grouped by year. Therefore, this data is complete.

## Data Analysis In-Depth

Next, how would I answer the question: **Did cougars eat during the winter?** 

Well, by my interpretation, I would think: Did cougars eat during the winter regardless of how much of their prey they consumed, how long, and if carnivores were nearby, etc. To answer that question more accurately, I can do data analyses thoroughly, tackling multiple scenarios.

#### List of Variables:
 \
Key variables: \
cougar ID \
cougar sex \
predation month (December to February) \
year \
predation date (December 14 - March 20 (Winter)) \
nightspent \
prey species \
prey age class \
prey weight class \

Dependent kittens variables: 
\ 
dependent kittens (yes or no) \
kittens 3 months \
kittens 6 months \

Others: 
\
bear density \
bear scavenge \
time spent between kill (by cougars) and investigation (for bears) \
deer density \
horse presence
\

```{r mutate_winter_days, echo = TRUE}
full_analysis <- data_completeness_unique %>%
  mutate(PredationDay = 
           day(PredationDate))
#adds a new column and reformatted the predation date to day number only 

full_analysis_rearranged <- full_analysis %>%
  select(CougarID, CougarSex, PredationDate, Year, PredationMonth, PredationDay,
         DependentKittens, Kittens.3months, Kittens.6months,
         NightsSpent, PreySpeciesSingle, PreyAgeClass, PreyWeightClass,
         HorsePresence, BearScav, BearDensity, DeerDensity)
#rearranged for better readability
```

```{r first_analysis_of_cougarsinwinteronly, echo = TRUE}
#first analysis
cougars_winter <- full_analysis_rearranged %>%
  group_by(Year) %>%
  filter(PredationMonth == "March" & PredationDay <= 20) %>%
  select(CougarID, CougarSex, PredationDate,
         NightsSpent, PreySpeciesSingle, PreyAgeClass, PreyWeightClass)

print(cougars_winter)
#Note that this research targets March-October while Winter starts 
#in December and ends in March 20, to be specific 
#so March is the only month. But, there indeed are some predations during early March

#I wonder if the mean differ between females and males per year
cougars_wintermean <- cougars_winter %>%
  group_by(CougarSex) %>%
  summarize(MeanNightsSpent = mean(NightsSpent, na.rm = TRUE))

print(cougars_wintermean)
#Males have slightly longer nights spent on feeding than females

#What about prey weightclass and maybe the kind of species?
cougars_winterpreysize <- cougars_winter %>%
  group_by(CougarSex, PreyWeightClass) %>%
  tally()

print(cougars_winterpreysize)

cougars_winterprey <- cougars_winter %>%
  group_by(CougarSex) %>%
  summarize(TotalPreys = n())

print(cougars_winterprey)
#Interesting females surpassed males in terms of 
#how many preys were eaten as well as frequency of larger preys
```

```{r dependentkittens_analysis, echo = TRUE}
#dependentkittens vs no kittens
cougars_kittens <- full_analysis_rearranged %>%
  group_by(CougarSex, Year, DependentKittens) %>%
  filter(DependentKittens >= "0" & PredationMonth == "March" & PredationDay <= "20") %>%
  tally()
#It is verified that no males have dependent kittens so only some females do

#How does females who has dependent kittens versus these who don't differ in preys size?
cougars_kittenprey <- cougars_kittens %>%
  group_by(Year, CougarSex, DependentKittens) %>%
  filter(CougarSex != "Male") %>%
  summarize(TotalPreyCount = n())

#Updated (Jan 24, 2025)
#fixed the data frame to use cougars_kittens instead of full_analysis_rearranged 
#because of the filter for March below day 20 

#verifying prey count 
preycount <- cougars_kittens %>%
  group_by(Year) %>%
  filter(CougarSex != "Male") %>%
  summarize(TotalPreyCount = n())

#Dependent PreyKill
dependentpreys <- cougars_kittens %>%
  group_by(DependentKittens) %>%
  filter(CougarSex != "Male") %>%
  summarize(TotalPreyCount = n())

#According to dependentpreys, females that have no dependent kittens 
#have higher predation than females with dependent kittens 
#which does not my expectations since I thought females who have them would 
#predate more often due to higher food demands

#Let's try the nightsspent variable and see
dependentnightspent <- full_analysis_rearranged %>%
  group_by(DependentKittens, Kittens.3months, Kittens.6months) %>%
  filter(CougarSex != "Male") %>%
  summarize(NightsSpentMean = mean(NightsSpent, na.rm = TRUE))

print(dependentnightspent)
#Nights spent for these with no dependent kittens 
#are slightly higher than these that have dependent kittens 
```

```{r other_variables_analysis, echo = TRUE}
#Updated (Jan 24, 2025): added filter() for March 20 or below

#other variables: horse presence, bear density, bear scav, and deer density
beardensity_scav <- full_analysis_rearranged %>%
  group_by(BearScav, CougarSex) %>%
  filter(PredationMonth == "March" & PredationDay <= 20) %>%
  summarize(BearDensityMean = mean(!is.na(BearDensity)), NightsSpentMean = mean(NightsSpent, na.rm = TRUE), DeerDensityMean = mean(DeerDensity))

print(beardensity_scav)
#checks how long cougars spent average at night feeding influenced by bears scavenging or not
#for bears that did scavenge, cougars spent less compared to no scavenging. Although, deer density is slightly higher when scavenging occur, but probably not significant

```

## Final Verdict: 

Overall, cougars were able to predate various preys, ranging from small to extra large sizes during late Winter. Females were able to predate more often than males. For these females with dependent kittens, they spent less time at nights feeding compared to males and other females with no dependent kittens. Logically, it could make sense given their need to hunt for preys frequently, and not only feed themselves but also dependent kittens. 

When bears scavenged, where it was unclear if it was active scavenging or passive scavenging (Engebretsen et al. 2021), cougars spent less time at nights than when there were no bears scavenging. In the contrary, Deers density during scavenging was slightly higher than without scavenging, although probably not as significant due to very small difference. 
 
In conclusion, even though the answer was a yes to the prompt question given the data analyses, I am not too confident because the data was missing other months: December, January, and February. With more data, it could give a clearer explanation of cougar's eating behavior during the entire Winter assuming that was the focus of the question. 

Updated (January 24, 2025): I forgot to use unique() to remove duplicates. Fortunately, the verdict is still the same after double checking how duplicates affect my data analyses. But, it is something to remember next time for further data analyses with unique(). 

################################################################################################

## Full R Script Below

#### Important Note: I used ChatGPT-4o to assist with debugging errors encountered while running this R script and fix up some data analyses coding
\
```{r full_script, echo = TRUE, results = "hide", message = FALSE, warning = FALSE}
#########
#R script setup
#########
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)

# Load necessary libraries
if (!requireNamespace("tinytex", quietly = TRUE)) {
  install.packages("tinytex")  # Install tinytex if not already installed
}

if (!requireNamespace("knitr", quietly = TRUE)) {
  install.packages("knitr")    # Install knitr if not already installed
}

#packages setup
library(tinytex)
library(knitr)

getwd()

#########
#Libraries and Excel Export
#########

#packages and libraries at the top
library(readxl)
library(dplyr)
library(reshape2)
library(lubridate) #for converting date format into day

cougarkillsites_completetable <- read_excel("Cougar Killsites.xlsx")
#Note: all of this data analysis are done within rproject for reproducibility

#########
#Quick Assessment of the Data Frame
#########

View(cougarkillsites_completetable) #opening up a tab to view the whole table
head(cougarkillsites_completetable) #opens up first 6 rows and a header
str(cougarkillsites_completetable) #list of all variables and type of data

#########
#Data Completeness
#########

data_completeness <- cougarkillsites_completetable %>%
  group_by(Year, PredationMonth) %>%
  tally()

print(data_completeness)
#the main goal is to find gaps between years and months by looking for an unique items 
#with duplicate counts for each as an easy way to check 

data_completeness_verifycount <- data_completeness %>%
  filter(Year == "2009") %>%
  group_by(PredationMonth) %>%
  filter(PredationMonth %in% c("April", "August", "July"))

print(data_completeness_verifycount)
#Verified the count by counting the year and the first few months: April, August, and July
#which matches with the data_completeness 

#to further verify for NA just to double check again
data_completeness_NA <- data_completeness %>%
  group_by(Year, PredationMonth) %>%
  filter(is.na(PredationMonth))

print(data_completeness_NA)
#result: 0 meaning no missing data for all months 

#########
#Data Analyses In-Depth
#########

full_analysis <- cougarkillsites_completetable %>%
  mutate(PredationDay = 
           day(PredationDate))
#adds a new column and reformatted the predation date to day number only 

full_analysis_rearranged <- full_analysis %>%
  select(CougarID, CougarSex, PredationDate, Year, PredationMonth, PredationDay,
         DependentKittens, Kittens.3months, Kittens.6months,
         NightsSpent, PreySpeciesSingle, PreyAgeClass, PreyWeightClass,
         HorsePresence, BearScav, BearDensity, DeerDensity)
#rearranged for better readability

#first analysis
cougars_winter <- full_analysis_rearranged %>%
  group_by(Year) %>%
  filter(PredationMonth == "March" & PredationDay <= 20) %>%
  select(CougarID, CougarSex, PredationDate,
         NightsSpent, PreySpeciesSingle, PreyAgeClass, PreyWeightClass)

print(cougars_winter)
#Note that this research targets March-October while Winter starts 
#in December and ends in March 20, to be specific 
#so March is the only month. But, there indeed are some predations during early March


#I wonder if the mean differ between females and males per year
cougars_wintermean <- cougars_winter %>%
  group_by(CougarSex) %>%
  summarize(MeanNightsSpent = mean(NightsSpent, na.rm = TRUE))

print(cougars_wintermean)
#Males have slightly longer nights spent on feeding than females

#What about prey weightclass and maybe the kind of species?
cougars_winterpreysize <- cougars_winter %>%
  group_by(CougarSex, PreyWeightClass) %>%
  tally()

print(cougars_winterpreysize)

cougars_winterprey <- cougars_winter %>%
  group_by(CougarSex) %>%
  summarize(TotalPreys = n())

print(cougars_winterprey)
#Interesting females surpassed males in terms of 
#how many preys were eaten as well as frequency of larger preys


#dependentkittens vs no kittens
cougars_kittens <- full_analysis_rearranged %>%
  group_by(CougarSex, Year, DependentKittens) %>%
  filter(DependentKittens >= "0" & PredationMonth == "March" & PredationDay <= "20") %>%
  tally()
#It is verified that no males have dependent kittens so only some females do

#How does females who has dependent kittens versus these who don't differ in preys size?
cougars_kittenprey <- full_analysis_rearranged %>%
  group_by(Year, CougarSex, DependentKittens) %>%
  filter(CougarSex != "Male") %>%
  summarize(TotalPreyCount = n())

#verifying prey count 
preycount <- full_analysis_rearranged %>%
  group_by(Year) %>%
  filter(CougarSex != "Male") %>%
  summarize(TotalPreyCount = n())

#Dependent PreyKill
dependentpreys <- full_analysis_rearranged %>%
  group_by(DependentKittens) %>%
  filter(CougarSex != "Male") %>%
  summarize(TotalPreyCount = n())

#According to dependentpreys, females that have no dependent kittens 
#have higher predation than females with dependent kittens 
#which does not my expectations since I thought females who have them would 
#predate more often due to higher food demands

#Let's try the nightsspent variable and see
dependentnightspent <- full_analysis_rearranged %>%
  group_by(DependentKittens, Kittens.3months, Kittens.6months) %>%
  filter(CougarSex != "Male") %>%
  summarize(NightsSpentMean = mean(NightsSpent, na.rm = TRUE))

print(dependentnightspent)
#Nights spent for these with no dependent kittens 
#are slightly higher than these that have dependent kittens 


#other variables: horse presence, bear density, bear scav, and deer density
beardensity_scav <- full_analysis_rearranged %>%
  group_by(BearScav, CougarSex) %>%
  summarize(BearDensityMean = mean(!is.na(BearDensity)), NightsSpentMean = mean(NightsSpent, na.rm = TRUE), DeerDensityMean = mean(DeerDensity))

print(beardensity_scav)
#checks how long cougars spent average at night feeding influenced by bears scavenging or not
#for bears that did scavenge, cougars spent less compared to no scavenging. Although, deer density is slightly higher when scavenging occur, but probably not significant

```